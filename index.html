<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>국가를 설계하라 - 픽셀아트 에디션</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- 스캔라인 효과 -->
    <div class="scanlines"></div>

    <!-- 메인 컨테이너 -->
    <div class="container">
        <!-- 시작 화면 -->
        <div id="startScreen" class="screen active">
            <div class="main-title">
                <div class="title-text">🏛️ 국가를 설계하라 🏛️</div>
                <div class="subtitle">~ PIXEL POLITICS SIMULATOR ~</div>
            </div>

            <div class="nations-grid">
                <!-- 국가 카드들은 JS에서 동적 생성 -->
            </div>

            <div class="loading" id="loadingAnimation">
                <div class="loading-pixel"></div>
                <div class="loading-pixel"></div>
                <div class="loading-pixel"></div>
            </div>

            <div class="start-section">
                <div class="start-message">
                    선택한 국가: <span id="selectedNation">국가를 선택해주세요</span>
                </div>
                <div class="button-group">
                    <button class="pixel-btn" onclick="handleStartGame()" id="startBtn" disabled>
                        🎮 게임 시작
                    </button>
                    <button class="pixel-btn secondary" onclick="handleShowHelp()">
                        ❓ 게임 설명
                    </button>
                </div>
            </div>
        </div>

        <!-- 게임 화면 -->
        <div id="gameScreen" class="screen">
            <!-- 상단 정보 바 -->
            <div class="game-header">
                <div class="nation-info">
                    <span class="nation-name-display" id="currentNationName">국가명</span>
                    <span class="turn-info" id="turnInfo">턴 1/5</span>
                </div>
                <div class="budget-info">
                    <span class="budget-amount" id="budgetAmount">💰 100pt</span>
                    <span class="budget-status" id="budgetStatus">✅ 안전</span>
                </div>
            </div>

            <!-- 지표 대시보드 -->
            <div class="indicators-panel">
                <div class="indicators-title">📊 국가 지표</div>
                <div class="indicators-grid" id="indicatorsGrid">
                    <!-- 지표들은 JS에서 동적 생성 -->
                </div>
            </div>

            <!-- 정책 선택 영역 -->
            <div class="policy-section">
                <div class="category-header">
                    <span class="category-title" id="categoryTitle">📋 정책 카테고리</span>
                    <span class="selection-info" id="selectionInfo">0/2 선택됨</span>
                </div>
                
                <div class="policies-grid" id="policiesGrid">
                    <!-- 정책 카드들은 JS에서 동적 생성 -->
                </div>

                <div class="selection-summary" id="selectionSummary">
                    <!-- 선택된 정책 요약 -->
                </div>

                <div class="action-buttons">
                    <button class="pixel-btn" onclick="handleConfirmPolicies()" id="confirmBtn" disabled>
                        ✅ 정책 확정
                    </button>
                    <button class="pixel-btn secondary" onclick="handleClearSelection()">
                        🔄 선택 초기화
                    </button>
                </div>
            </div>
        </div>

        <!-- 이벤트 화면 (팝업) -->
        <div id="eventPopup" class="popup-overlay">
            <div class="popup-content">
                <div class="popup-header">
                    <h3 id="eventTitle">📢 긴급 상황 발생!</h3>
                </div>
                <div class="popup-body">
                    <p id="eventDescription">이벤트 설명이 여기에 표시됩니다.</p>
                    <div class="event-effects" id="eventEffects">
                        <!-- 이벤트 효과 표시 -->
                    </div>
                    <div class="event-choices" id="eventChoices">
                        <!-- 이벤트 선택지들 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 시민 반응 패널 -->
        <div class="citizen-panel" id="citizenPanel">
            <div class="panel-header">💬 시민들의 반응</div>
            <div class="meme-display" id="memeDisplay">
                <!-- 밈 반응들 -->
            </div>
        </div>

        <!-- 결과 화면 -->
        <div id="resultsScreen" class="screen">
            <div class="results-container">
                <div class="final-title" id="finalTitle">🏆 게임 완료!</div>
                <div class="ending-info" id="endingInfo">
                    <!-- 엔딩 정보 -->
                </div>
                <div class="final-stats" id="finalStats">
                    <!-- 최종 통계 -->
                </div>
                <div class="achievements" id="achievements">
                    <!-- 달성한 업적들 -->
                </div>
                <div class="replay-buttons">
                    <button class="pixel-btn" onclick="handleRestartGame()">
                        🔄 다시 플레이
                    </button>
                    <button class="pixel-btn secondary" onclick="handleShareResults()">
                        📤 결과 공유
                    </button>
                </div>
            </div>
        </div>

        <!-- 도움말 화면 (팝업) -->
        <div id="helpPopup" class="popup-overlay">
            <div class="popup-content help-content">
                <div class="popup-header">
                    <h3>❓ 게임 설명</h3>
                    <button class="close-btn" onclick="handleCloseHelp()">✖</button>
                </div>
                <div class="popup-body">
                    <div class="help-section">
                        <h4>🎯 게임 목표</h4>
                        <p>5턴에 걸쳐 정책을 선택하여 최고의 국가를 만드세요!</p>
                    </div>
                    <div class="help-section">
                        <h4>🎮 게임 방법</h4>
                        <ul>
                            <li>각 턴마다 해당 분야에서 최대 2개 정책 선택</li>
                            <li>예산을 고려하여 신중하게 선택하세요</li>
                            <li>정책 간 충돌과 시너지를 확인하세요</li>
                            <li>시민들의 반응을 체크하세요</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h4>📊 지표 설명</h4>
                        <ul>
                            <li>💰 경제: 국가의 경제 상황</li>
                            <li>🚀 기술: 과학기술 발전 수준</li>
                            <li>😊 시민반응: 국민들의 만족도</li>
                            <li>🌱 환경: 환경 보호 수준</li>
                            <li>💼 재정: 국가 재정 건전성</li>
                            <li>🛡️ 안정성: 사회 안정 정도</li>
                            <li>❤️ 복지: 사회 복지 수준</li>
                            <li>🤝 외교: 국제 관계 상태</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 상태 표시 바 -->
    <div class="status-bar">
        <div class="status-item">🎮 픽셀 정치 시뮬레이터</div>
        <div class="status-item" id="gameStatus">대기 중...</div>
        <div class="status-item" id="systemStatus">시스템 정상</div>
    </div>

    <!-- JavaScript 파일들 - 순서가 중요! -->
    <script src="js/data.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ui.js"></script>
    
    <!-- 초기화 스크립트 -->
    <script>
        // 전역 변수들
        let selectedNationName = null;
        let currentEvent = null;

        // 안전한 함수 호출을 위한 래퍼 함수들
        function handleStartGame() {
            try {
                if (typeof startGame === 'function') {
                    startGame();
                } else {
                    console.error('startGame 함수를 찾을 수 없습니다');
                    alert('게임 시스템 로딩 중입니다. 잠시 후 다시 시도해주세요.');
                }
            } catch (error) {
                console.error('게임 시작 오류:', error);
                alert('게임 시작 중 오류가 발생했습니다: ' + error.message);
            }
        }

        function handleShowHelp() {
            try {
                if (typeof showHelp === 'function') {
                    showHelp();
                } else {
                    alert('도움말을 준비 중입니다.');
                }
            } catch (error) {
                console.error('도움말 표시 오류:', error);
            }
        }

        function handleCloseHelp() {
            try {
                if (typeof closeHelp === 'function') {
                    closeHelp();
                } else {
                    document.getElementById('helpPopup').classList.remove('active');
                }
            } catch (error) {
                console.error('도움말 닫기 오류:', error);
            }
        }

        function handleConfirmPolicies() {
            try {
                if (typeof confirmPolicies === 'function') {
                    confirmPolicies();
                } else {
                    alert('정책 확정 기능을 로딩 중입니다.');
                }
            } catch (error) {
                console.error('정책 확정 오류:', error);
            }
        }

        function handleClearSelection() {
            try {
                if (typeof clearSelection === 'function') {
                    clearSelection();
                } else {
                    alert('선택 초기화 기능을 로딩 중입니다.');
                }
            } catch (error) {
                console.error('선택 초기화 오류:', error);
            }
        }

        function handleRestartGame() {
            try {
                if (typeof restartGame === 'function') {
                    restartGame();
                } else {
                    location.reload();
                }
            } catch (error) {
                console.error('게임 재시작 오류:', error);
            }
        }

        function handleShareResults() {
            try {
                if (typeof shareResults === 'function') {
                    shareResults();
                } else {
                    alert('결과 공유 기능을 준비 중입니다.');
                }
            } catch (error) {
                console.error('결과 공유 오류:', error);
            }
        }

        // 국가 선택 함수 (전역으로 정의)
        function selectNation(nationName) {
            console.log('국가 선택:', nationName);
            
            try {
                // 이전 선택 해제
                document.querySelectorAll('.nation-card').forEach(card => {
                    card.classList.remove('selected');
                });

                // 현재 선택 활성화
                event.target.closest('.nation-card').classList.add('selected');
                selectedNationName = nationName;
                
                document.getElementById('selectedNation').textContent = nationName;
                document.getElementById('startBtn').disabled = false;
                
                // 사운드 재생 (안전하게)
                try {
                    if (typeof gameUtils !== 'undefined' && gameUtils.playSound) {
                        gameUtils.playSound('select');
                    }
                } catch (soundError) {
                    console.log('사운드 재생 실패:', soundError);
                }

                console.log('선택된 국가:', selectedNationName);
            } catch (error) {
                console.error('국가 선택 오류:', error);
            }
        }

        // 페이지 로드 완료 후 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎮 페이지 로드 완료');
            
            // 잠시 기다린 후 초기화 (모든 스크립트가 로드되도록)
            setTimeout(function() {
                try {
                    if (typeof initializeStartScreen === 'function') {
                        initializeStartScreen();
                        console.log('✅ 시작 화면 초기화 완료');
                    } else {
                        console.log('⚠️ initializeStartScreen 함수 없음 - 수동 초기화');
                        manualInitializeStartScreen();
                    }
                } catch (error) {
                    console.error('초기화 오류:', error);
                    manualInitializeStartScreen();
                }
            }, 100);
        });

        // 수동 초기화 함수 (백업용)
        function manualInitializeStartScreen() {
            console.log('수동 초기화 시작');
            
            const nationsGrid = document.querySelector('.nations-grid');
            if (!nationsGrid) {
                console.error('nations-grid를 찾을 수 없습니다');
                return;
            }
            
            nationsGrid.innerHTML = '';

            const nations = {
                '복지 강국': { description: '복지 수준이 높지만 재정 부담과 제도 피로도가 존재함', stars: 1 },
                '자원 풍부국': { description: '자원이 풍부하지만 환경 갈등이 잦고 산업 의존도가 높음', stars: 2 },
                '기술 선진국': { description: '기술력이 뛰어나지만 시민 신뢰도가 낮고 윤리 갈등이 존재함', stars: 3 },
                '신흥 개발국': { description: '성장 중인 국가로 인프라 부족과 사회 불균형이 문제', stars: 2 },
                '위기국가': { description: '정치·사회·경제 모두 불안정한 상태에서 재건이 필요한 국가', stars: 3 }
            };

            Object.entries(nations).forEach(([nationName, data]) => {
                const card = document.createElement('div');
                card.className = 'nation-card';
                card.onclick = () => selectNation(nationName);
                
                const stars = '★'.repeat(data.stars) + '☆'.repeat(3 - data.stars);
                
                card.innerHTML = `
                    <div class="nation-name">${nationName}</div>
                    <div class="difficulty-stars">${stars}</div>
                    <div class="nation-description">${data.description}</div>
                `;
                
                nationsGrid.appendChild(card);
            });

            console.log('수동 초기화 완료');
        }

        // 오류 감지
        window.addEventListener('error', function(event) {
            console.error('JavaScript 오류:', event.error);
        });
        
        console.log('🚀 메인 스크립트 로딩 완료');
    </script>
</body>
</html>
